<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 2 - Docker :: Learning Cloudnative 101</title>
    <link rel="canonical" href="https://ibm-cloud-architecture.github.io/learning-cloudnative-101/web/1.0.0/Kubernetes_Module/Lab2.html">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <p>Learning Cloudnative 101</p>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="web" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../Cloud_Native_Module/Cloudnative_Overview.html">Learning Cloudnative 101</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cloud Native</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Cloud_Native_Module/Cloudnative_Overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Cloud_Native_Module/Cloudnative_framework_prog_model.html">Framework &amp; Programming Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Cloud_Native_Module/Cloudnative_app_development.html">App Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Cloud_Native_Module/Lab1.html">Lab 1: App Development</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Containers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Docker.html">Containerization</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="Lab2.html">Lab 2: Docker</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Kubernetes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kubernetesPatterns.html">Kubernetes Patterns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Lab3.html">Lab 3: Deploy Kubernetes App</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="Lab3.html#_deploy_kubernetes_app_using_openshift_console">Using OCP Console</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="Lab3.html#_deploy_kubernetes_app_using_oc_cli">Using oc CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Lab4.html">Lab 4: Update Kubernetes App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operators.html">Helm/Operator Patterns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Lab5.html">Lab 5: Helm Templates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cloud Foundry to Kubernetes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../CF_Migrate_Module/Kubernetes-for-CF.html">Kubernetes for CF users</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../CF_Migrate_Module/CF-migration.html">CF Migration Tool</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lab 7: CF2K8S</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../CF_Migrate_Module/cf-migrate-exercise-ocp.html">Lab 7: CF2K8S - OpenShift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../CF_Migrate_Module/cf-migrate-exercise-iks.html">Lab 7: CF2K8S - IKS</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">DevOps and CICD</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../DevOps_Module/Devops_Concepts.html">DevOps Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../DevOps_Module/cicd.html">CI/CD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../DevOps_Module/devops_tooling.html">Devops Tooling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lab 8: CI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../DevOps_Module/Lab8_Openshift.html">Lab 8: CI - Openshift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../DevOps_Module/Lab8_IKS.html">Lab 8: CI - IKS</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lab 9: CD</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../DevOps_Module/Lab9_OpenShift.html">Lab 9: CD - Openshift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../DevOps_Module/Lab9_IKS.html">Lab 9: CD - IKS</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Learning Cloudnative 101</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Learning Cloudnative 101</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../Cloud_Native_Module/Cloudnative_Overview.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../Cloud_Native_Module/Cloudnative_Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../Cloud_Native_Module/Cloudnative_Overview.html">Learning Cloudnative 101</a></li>
    <li>Containers</li>
    <li><a href="Lab2.html">Lab 2: Docker</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/ibm-cloud-architecture/learning-cloudnative-101/edit/master/modules/ROOT/pages/Kubernetes_Module/Lab2.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1 class="page">Lab 2 - Docker</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_working_with_docker">Working with docker</a></li>
<li><a href="#_get_the_sample_application">Get the sample application</a></li>
<li><a href="#_run_the_application_on_docker">Run the application on Docker</a>
<ul class="sectlevel2">
<li><a href="#_build_the_application">Build the application</a></li>
<li><a href="#_build_the_docker_image">Build the docker image</a></li>
<li><a href="#_run_the_docker_container">Run the docker container</a></li>
<li><a href="#_access_the_application">Access the application</a></li>
<li><a href="#_pushing_an_image_to_a_registry">Pushing an image to a Registry</a></li>
<li><a href="#_clean_up">Clean Up</a></li>
<li><a href="#_pulling_an_image_from_the_registry">Pulling an image from the registry</a></li>
</ul>
</li>
<li><a href="#_run_the_application_on_docker_using_multi_stage_build">Run the application on Docker using multi-stage build</a>
<ul class="sectlevel2">
<li><a href="#_build_the_docker_image_2">Build the docker image</a></li>
<li><a href="#_run_the_docker_container_2">Run the docker container</a></li>
<li><a href="#_access_the_application_2">Access the application</a></li>
<li><a href="#_clean_up_2">Clean Up</a></li>
</ul>
</li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, you will learn about how to use docker and how to run applications using docker.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>You need <a href="https://www.java.com/en/">Java</a> installed on your environment. You can download it <a href="https://www.java.com/download/">here</a>. Please install the latest version which is Java Version 8. Make sure you set <code>JAVA_HOME</code> environment variable. You can verify the version after installation using <code>java -version</code>.</p>
</li>
<li>
<p>Create a <a href="https://hub.docker.com/">DockerHub account</a>. This account is needed to push images to docker registry. Also create a repository following the instructions <a href="https://docs.docker.com/docker-hub/repos/">here</a>.</p>
</li>
<li>
<p>You need to install <a href="https://www.docker.com/">Docker</a> in your environment. Follow the instructions <a href="https://docs.docker.com/docker-for-mac/install/">here</a> to install it on Mac and <a href="https://docs.docker.com/docker-for-windows/install/">here</a> to install it on Windows.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_docker"><a class="anchor" href="#_working_with_docker"></a>Working with docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before proceeding, make sure docker is properly installed on your system. To verify this, run the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker -v</code></pre>
</div>
</div>
<div class="paragraph">
<p>If it is installed, you will see a version number something similar to below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Docker version 19.03.0-beta3, build c55e026</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong class="big maroon">Running a hello-world container</strong></p>
</div>
<div class="paragraph">
<p>Let us start with a <code>hello-world</code> container. To run a <code>hello-world</code> container, use the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run hello-world</code></pre>
</div>
</div>
<div class="paragraph">
<p>If it is successfully run, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
1b930d010525: Pull complete
Digest: sha256:41a65640635299bab090f783209c1e3a3f11934cf7756b09cb2f1e02147c6ed8
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since, <code>hello-world</code> image is not existing locally, it is pulled from <code>library/hello-world</code>. But if it is already existing, docker will not pull it every time but rather use the existing one.</p>
</div>
<div class="paragraph">
<p>This image is pulled from <a href="https://hub.docker.com/_/hello-world" class="bare">https://hub.docker.com/_/hello-world</a>. Docker hub is a repository used to store docker images. Similarly, you can use your own registries to store images. For example, IBM Cloud provides you a container registry.</p>
</div>
<div class="paragraph">
<p><strong class="big maroon">Verifying the hello-world image</strong></p>
</div>
<div class="paragraph">
<p>To verify if an image is existing in your system locally, run the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker images</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will then see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              fce289e99eb9        5 months ago        1.84kB</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_get_the_sample_application"><a class="anchor" href="#_get_the_sample_application"></a>Get the sample application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get the sample application, you will need to clone it from github.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Clone the sample app
$ git clone https://github.com/ibm-cloud-architecture/cloudnative_sample_app.git

# Go to the project's root folder
$ cd cloudnative_sample_app/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_the_application_on_docker"><a class="anchor" href="#_run_the_application_on_docker"></a>Run the application on Docker</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_build_the_application"><a class="anchor" href="#_build_the_application"></a>Build the application</h3>
<div class="paragraph">
<p>To build the application, use the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw install</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will notice something at the end like below once done.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[INFO] --- maven-install-plugin:2.5.2:install (default-install) @ cloudnativesampleapp ---
[INFO] Installing /Users/user@ibm.com/cloudnative_sample_app/target/cloudnativesampleapp-1.0-SNAPSHOT.jar to /Users/user@ibm.com/.m2/repository/projects/cloudnativesampleapp/1.0-SNAPSHOT/cloudnativesampleapp-1.0-SNAPSHOT.jar
[INFO] Installing /Users/user@ibm.com/cloudnative_sample_app/pom.xml to /Users/user@ibm.com/.m2/repository/projects/cloudnativesampleapp/1.0-SNAPSHOT/cloudnativesampleapp-1.0-SNAPSHOT.pom
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  34.714 s
[INFO] Finished at: 2019-06-28T11:11:06-05:00
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_the_docker_image"><a class="anchor" href="#_build_the_docker_image"></a>Build the docker image</h3>
<div class="paragraph">
<p>Let&#8217;s take look at the docker file before building it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM openliberty/open-liberty:springBoot2-ubi-min as staging
USER root
COPY target/cloudnativesampleapp-1.0-SNAPSHOT.jar /staging/fatClinic.jar

RUN springBootUtility thin \
 --sourceAppPath=/staging/fatClinic.jar \
 --targetThinAppPath=/staging/thinClinic.jar \
 --targetLibCachePath=/staging/lib.index.cache

FROM openliberty/open-liberty:springBoot2-ubi-min
USER root
COPY --from=staging /staging/lib.index.cache /opt/ol/wlp/usr/shared/resources/lib.index.cache
COPY --from=staging /staging/thinClinic.jar /config/dropins/spring/thinClinic.jar

RUN chown -R 1001.0 /config &amp;&amp; chmod -R g+rw /config
RUN chown -R 1001.0 /opt/ol/wlp/usr/shared/resources/lib.index.cache &amp;&amp; chmod -R g+rw /opt/ol/wlp/usr/shared/resources/lib.index.cache

USER 1001</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <code>FROM</code> instruction, we provide the name and tag of an image that should be used as our base. This must always be the first instruction in the Dockerfile.</p>
</li>
<li>
<p><code>USER</code> instruction sets the username (or UID).</p>
</li>
<li>
<p>Using <code>COPY</code> instruction, we copy new contents from the source filesystem to the container filesystem.</p>
</li>
<li>
<p><code>RUN</code> instruction executes the commands.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once, you have the docker file ready, the next step is to build it. The <code>build</code> command allows you to build a docker image which you can later run as a container.</p>
</div>
<div class="paragraph">
<p>The command is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker build -t &lt;image_name&gt;:&lt;image_tag&gt; .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>-t</code> flag allows you to add a name to your image and optionally you can also add a tag. If you don&#8217;t add a tag, by default the tag is <code>latest</code>. Also, the <code>.</code> at the end of the command specifies that the path for the Dockerfile is the current directory.</p>
</div>
<div class="paragraph">
<p>To build the docker image for our sample application, run the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker build -t greeting:v1.0.0 .</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker build -t greeting:v1.0.0 .
Sending build context to Docker daemon  22.17MB
Step 1/11 : FROM openliberty/open-liberty:springBoot2-ubi-min as staging
springBoot2-ubi-min: Pulling from openliberty/open-liberty
949de0c45264: Pull complete
7e9d54341c0e: Pull complete
32db7409eb5f: Pull complete
7640ec54eca1: Pull complete
f081c7c2f0e0: Pull complete
51c03cd5ee07: Pull complete
f716fe3cdacf: Pull complete
daed7a0739aa: Pull complete
d876e280fa2d: Pull complete
Digest: sha256:d51b2eb61d32599712c333f8d6a4e4297cb57d6c7981ab15a14f744d46710b0f
Status: Downloaded newer image for openliberty/open-liberty:springBoot2-ubi-min
 ---&gt; bcfcb2c5ce16
Step 2/11 : USER root
 ---&gt; Running in 26a12ce640db
Removing intermediate container 26a12ce640db
 ---&gt; 9e891aecf123
Step 3/11 : COPY target/cloudnativesampleapp-1.0-SNAPSHOT.jar /staging/fatClinic.jar
 ---&gt; 7c0f26bc76e7
Step 4/11 : RUN springBootUtility thin  --sourceAppPath=/staging/fatClinic.jar  --targetThinAppPath=/staging/thinClinic.jar  --targetLibCachePath=/staging/lib.index.cache
 ---&gt; Running in 2d68ff957a28
Creating a thin application from: /staging/fatClinic.jar
Library cache: /staging/lib.index.cache
Thin application: /staging/thinClinic.jar
Removing intermediate container 2d68ff957a28
 ---&gt; f9cad508cb4c
Step 5/11 : FROM openliberty/open-liberty:springBoot2-ubi-min
 ---&gt; bcfcb2c5ce16
Step 6/11 : USER root
 ---&gt; Using cache
 ---&gt; 9e891aecf123
Step 7/11 : COPY --from=staging /staging/lib.index.cache /opt/ol/wlp/usr/shared/resources/lib.index.cache
 ---&gt; 0e27922ad7a6
Step 8/11 : COPY --from=staging /staging/thinClinic.jar /config/dropins/spring/thinClinic.jar
 ---&gt; 93bd8360110b
Step 9/11 : RUN chown -R 1001.0 /config &amp;&amp; chmod -R g+rw /config
 ---&gt; Running in ea42c7b6f92a
Removing intermediate container ea42c7b6f92a
 ---&gt; 764ef4196d1b
Step 10/11 : RUN chown -R 1001.0 /opt/ol/wlp/usr/shared/resources/lib.index.cache &amp;&amp; chmod -R g+rw /opt/ol/wlp/usr/shared/resources/lib.index.cache
 ---&gt; Running in 2b1738422b89
Removing intermediate container 2b1738422b89
 ---&gt; af170c7af294
Step 11/11 : USER 1001
 ---&gt; Running in 98fc928c9778
Removing intermediate container 98fc928c9778
 ---&gt; 89bd7032fdee
Successfully built 89bd7032fdee
Successfully tagged greeting:v1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify if the image is built successfully, run the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker images</code></pre>
</div>
</div>
<div class="paragraph">
<p>It shows the images, their repository and tags, and their size.</p>
</div>
<div class="paragraph">
<p>The output will be as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker images
REPOSITORY                           TAG                   IMAGE ID            CREATED             SIZE
greeting                             v1.0.0                89bd7032fdee        51 seconds ago      402MB
openliberty/open-liberty             springBoot2-ubi-min   bcfcb2c5ce16        6 days ago          366MB
hello-world                          latest                f9cad508cb4c        5 months ago        1.84kB</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_docker_container"><a class="anchor" href="#_run_the_docker_container"></a>Run the docker container</h3>
<div class="ulist">
<ul>
<li>
<p>To run the docker container, use the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -p &lt;port_to_expose&gt;:&lt;port&gt; -d --name &lt;container_name&gt; &lt;image_name&gt;:&lt;tag&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-p</code>: Allows you to publish the containers port to the host.</p>
</li>
<li>
<p><code>-d</code>: Runs the container in background in detached mode.</p>
</li>
<li>
<p><code>--name</code>: Allows you to specify the name of the container. If you don&#8217;t use this one, docker creates a name automatically.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To run the docker container for our sample application, use the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -p 9080:9080 -d --name greeting greeting:v1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once done, you will have something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -p 9080:9080 -d --name greeting greeting:v1.0.0
bc2dc95a6bd1f51a226b291999da9031f4443096c1462cb3fead3df36613b753</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, docker cannot create two containers with the same name. If you try to run the same container having the same name again, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -p 9080:9080 -d --name greeting greeting:v1.0.0
docker: Error response from daemon: Conflict. The container name "/greeting" is already in use by container "a74b91789b29af6e7be92b30d0e68eef852bfb24336a44ef1485bb58becbd664". You have to remove (or rename) that container to be able to reuse that name.
See 'docker run --help'.</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is a good practice to name your containers. Naming helps you to discover your service easily.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To list all the running containers, use the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker ps</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                              NAMES
bc2dc95a6bd1        greeting:v1.0.0     "/opt/ol/helpers/run…"   18 minutes ago      Up 18 minutes       0.0.0.0:9080-&gt;9080/tcp, 9443/tcp   greeting</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To know more about the container, you can inspect the container.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Run the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker inspect &lt;container-name|container-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By inspecting the container, you can access detailed information about the container. By using this command, you get to know the details about network settings, volumes, configs, state etc.</p>
</div>
<div class="paragraph">
<p>If we consider our container, it is as follows. You can see lot of information about the <code>greeting</code> container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker inspect greeting
[
    {
        "Id": "bc2dc95a6bd1f51a226b291999da9031f4443096c1462cb3fead3df36613b753",
        "Created": "2019-08-30T16:56:40.2081539Z",
        "Path": "/opt/ol/helpers/runtime/docker-server.sh",
        "Args": [
            "/opt/ol/wlp/bin/server",
            "run",
            "defaultServer"
        ],
        "State": {
            "Status": "running",
            "Running": true,
            "Paused": false,
            "Restarting": false,
            "OOMKilled": false,
            "Dead": false,
            "Pid": 27548,
            "ExitCode": 0,
            "Error": "",
            "StartedAt": "2019-08-30T16:56:41.0927889Z",
            "FinishedAt": "0001-01-01T00:00:00Z"
        },
        ..........
        ..........
        ..........
    }
]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To get the logs, you use the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker logs &lt;container-name|container-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It helps you to access the logs of your container. It allows you to debug the container if it fails. It also lets you to know what is happening with your application.</p>
</div>
<div class="paragraph">
<p>If we consider our container, it is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker logs greeting</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the end, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">.   ____          _            __ _ _
/\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
\\/  ___)| |_)| | | | | || (_| |  ) ) ) )
'  |____| .__|_| |_|_| |_\__, | / / / /
=========|_|==============|___/=/_/_/_/
:: Spring Boot ::        (v2.1.7.RELEASE)
2019-08-30 16:57:01.494  INFO 1 --- [ecutor-thread-5] application.SBApplication                : Starting SBApplication on bc2dc95a6bd1 with PID 1 (/opt/ol/wlp/usr/servers/defaultServer/dropins/spring/thinClinic.jar started by default in /opt/ol/wlp/output/defaultServer)
2019-08-30 16:57:01.601  INFO 1 --- [ecutor-thread-5] application.SBApplication                : No active profile set, falling back to default profiles: default
[AUDIT   ] CWWKT0016I: Web application available (default_host): http://bc2dc95a6bd1:9080/
2019-08-30 16:57:09.641  INFO 1 --- [cutor-thread-25] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 7672 ms
2019-08-30 16:57:12.279  INFO 1 --- [ecutor-thread-5] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 15 endpoint(s) beneath base path '/actuator'
2019-08-30 16:57:12.974  INFO 1 --- [ecutor-thread-5] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'
2019-08-30 16:57:13.860  INFO 1 --- [ecutor-thread-5] d.s.w.p.DocumentationPluginsBootstrapper : Context refreshed
2019-08-30 16:57:13.961  INFO 1 --- [ecutor-thread-5] d.s.w.p.DocumentationPluginsBootstrapper : Found 1 custom documentation plugin(s)
2019-08-30 16:57:14.020  INFO 1 --- [ecutor-thread-5] s.d.s.w.s.ApiListingReferenceScanner     : Scanning for api listing references
2019-08-30 16:57:14.504  INFO 1 --- [ecutor-thread-5] application.SBApplication                : Started SBApplication in 17.584 seconds (JVM running for 33.368)
[AUDIT   ] CWWKZ0001I: Application thinClinic started in 21.090 seconds.
[AUDIT   ] CWWKF0012I: The server installed the following features: [el-3.0, jsp-2.3, servlet-4.0, springBoot-2.0, ssl-1.0, transportSecurity-1.0, websocket-1.1].
[AUDIT   ] CWWKF0011I: The defaultServer server is ready to run a smarter planet. The defaultServer server started in 33.103 seconds.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows that the Spring Boot application is successfully started.</p>
</div>
</div>
<div class="sect2">
<h3 id="_access_the_application"><a class="anchor" href="#_access_the_application"></a>Access the application</h3>
<div class="ulist">
<ul>
<li>
<p>To access the application, open the browser and access <a href="http://localhost:9080/greeting?name=John" class="bare">http://localhost:9080/greeting?name=John</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{"id":2,"content":"Welcome to Cloudnative bootcamp !!! Hello, John :)"}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong class="maroon">Container Image Registry</strong></p>
</div>
<div class="paragraph">
<p>Container Image Registry is a place where you can store the container images. They can be public or private registries. They can be hosted by third party as well. In this lab, we are using DockerHub.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pushing_an_image_to_a_registry"><a class="anchor" href="#_pushing_an_image_to_a_registry"></a>Pushing an image to a Registry</h3>
<div class="paragraph">
<p>Let us now push the image to docker hub registry.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Before pushing the image to the registry, one needs to login. Let us now login into the docker hub registry.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker login</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enter your Docker Hub credentials.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.
Username: &lt;user_name&gt;
Password:
Login Succeeded</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Tag your image. To push an image to a registry, you need to tag it with the repository name and port (port is optional). This command helps you to do that.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker tag &lt;src_image_name&gt;:&lt;tag&gt; &lt;repository_name&gt;/&lt;target_image&gt;:&lt;tag&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let us now tag the image we built previously.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker tag greeting:v1.0.0 &lt;repository_name&gt;/greeting:v1.0.0</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Now push the image to the registry. This allows you to share images to a registry.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker push &lt;repository_name&gt;/&lt;image_name&gt;:&lt;tag&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In our case, it will be as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker push &lt;repository_name&gt;/greeting:v1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>If everything goes fine, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker push &lt;repository_name&gt;/greeting:v1.0.0
The push refers to repository [docker.io/&lt;repository_name&gt;/greeting]
2e4d09cd03a2: Pushed
d862b7819235: Pushed
a9212239031e: Pushed
4be784548734: Pushed
a43c287826a1: Mounted from library/ibmjava
e936f9f1df3e: Mounted from library/ibmjava
92d3f22d44f3: Mounted from library/ibmjava
10e46f329a25: Mounted from library/ibmjava
24ab7de5faec: Mounted from library/ibmjava
1ea5a27b0484: Mounted from library/ibmjava
v1.0.0: digest: sha256:21c2034646a31a18b053546df00d9ce2e0871bafcdf764f872a318a54562e6b4 size: 2415</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the push is successful, your image will be residing in the registry.</p>
</div>
</div>
<div class="sect2">
<h3 id="_clean_up"><a class="anchor" href="#_clean_up"></a>Clean Up</h3>
<div class="ulist">
<ul>
<li>
<p>To stop the container, run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker stop &lt;container-name|container-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For our sample application, it is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker stop greeting
greeting</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To remove the container, run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker rm &lt;container-name|container-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For our sample application, it is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker rm greeting
greeting</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To remove the image, run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker rmi &lt;image_id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Get the image_ids and then remove them. Use the below commands to do that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
greeting            v1.0.0              3ae7dfc4b794        About an hour ago   251MB
ibmjava             8-sfj               ab418b419902        9 days ago          222MB

$ docker rmi 3ae7dfc4b794 ab418b419902
Untagged: greeting:v1.0.0
Deleted: sha256:3ae7dfc4b794bf97684110e0a9392b121f63002ab35a46facf3edf281f47d27a
Deleted: sha256:3200b25a9898291bdee9e46c9fff1214791858bfc789e5ee9d6f1455fc9d33c6
Deleted: sha256:ad42c72c8e8a52d8730aeb21e28ca408951302c61a762c89fcbf502b143777ce
Deleted: sha256:393041ba04b55817a106508daa2afdffc9b011b550ed684c9b6a42c070487090
Deleted: sha256:d0693367c12ce7d34415ffce10e489a6fd9c8a3cd8c2c944df1374969b60835e
Untagged: ibmjava:8-sfj
Untagged: ibmjava@sha256:aaef6e7d14b3c63b8df9eaea45334d3cc7678ba3878dfcb630be8706719df97e
Deleted: sha256:ab418b419902ecc54a6f2b4c0f485c1105eec3395f253040087a954528de7b1b
Deleted: sha256:2ffcfbe8352bdf9c70b66692e436ab03f01ca3dce37d7d49c79f5c4c80ec2044
Deleted: sha256:c896bc720df99ee1a6ce305d17edfda42b043a47223ff2ac3e4f94199e6d595b
Deleted: sha256:03952d61b1fc131f23629c02f7ffb93708ae77108a32e4eedd83d4ec987ba51c
Deleted: sha256:a48e1b8909b41276ed1666d5262d981258163c6f0998b58e61efa4188944652e
Deleted: sha256:872ef8aee8632246e43a346a70274030c3613fe81af162a2fb6d14e1fcba980d
Deleted: sha256:1ea5a27b0484f2a227275fbb913d281461d9f356134a56002574904c3cfdea04</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pulling_an_image_from_the_registry"><a class="anchor" href="#_pulling_an_image_from_the_registry"></a>Pulling an image from the registry</h3>
<div class="paragraph">
<p>Sometimes, you may need the images that are residing on your registry. Or you may want to use some public images out there. Then, we need to pull the image from the registry.</p>
</div>
<div class="paragraph">
<p>To pull the image from the registry, use the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker pull &lt;repository_name&gt;/&lt;image_name&gt;:&lt;tag&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since, we deleted the one we created previously, let us now push it from the registry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker pull &lt;repository_name&gt;/greeting:v1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>If it successfully got pulled, we will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ddcb5f219ce2: Pull complete
e3371bbd24a0: Pull complete
49d2efb3c01b: Pull complete
Digest: sha256:21c2034646a31a18b053546df00d9ce2e0871bafcdf764f872a318a54562e6b4
Status: Downloaded newer image for &lt;repository_name&gt;/greeting:v1.0.0
docker.io/&lt;repository_name&gt;/greeting:v1.0.0</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_the_application_on_docker_using_multi_stage_build"><a class="anchor" href="#_run_the_application_on_docker_using_multi_stage_build"></a>Run the application on Docker using multi-stage build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this, building the application is a part of the docker image. It automatically does it for you. You need not run <code>mvn install</code> explicitly.</p>
</div>
<div class="sect2">
<h3 id="_build_the_docker_image_2"><a class="anchor" href="#_build_the_docker_image_2"></a>Build the docker image</h3>
<div class="paragraph">
<p>Let&#8217;s take look at the docker file before building it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Build stage - could use maven or our image
FROM maven:3.3-jdk-8 as builder

# Creating Work directory
ENV BUILD_DIR=/usr/src/app/
RUN mkdir $BUILD_DIR
WORKDIR $BUILD_DIR

# Reuse local .m2. if not all the dependencies will be always downloaded
# This can be removed if you want to
VOLUME ${HOME}/.m2:/root/.m2
ADD . /usr/src/app

RUN bash -c " mvn clean install"

FROM openliberty/open-liberty:springBoot2-ubi-min as staging
USER root

# Create app directory
ENV APP_HOME=/app
WORKDIR $APP_HOME

# Copy jar file over from builder stage
COPY --from=builder /usr/src/app/target/cloudnativesampleapp-1.0-SNAPSHOT.jar $APP_HOME
RUN mv ./cloudnativesampleapp-1.0-SNAPSHOT.jar app.jar

RUN springBootUtility thin \
 --sourceAppPath=app.jar \
 --targetThinAppPath=/staging/thinClinic.jar \
 --targetLibCachePath=/staging/lib.index.cache

FROM openliberty/open-liberty:springBoot2-ubi-min
USER root
COPY --from=staging /staging/lib.index.cache /opt/ol/wlp/usr/shared/resources/lib.index.cache
COPY --from=staging /staging/thinClinic.jar /config/dropins/spring/thinClinic.jar

RUN chown -R 1001.0 /config &amp;&amp; chmod -R g+rw /config
RUN chown -R 1001.0 /opt/ol/wlp/usr/shared/resources/lib.index.cache &amp;&amp; chmod -R g+rw /opt/ol/wlp/usr/shared/resources/lib.index.cache

USER 1001</pre>
</div>
</div>
<div class="paragraph">
<p>This Dockerfile leverages multi-stage builds, which lets you create multiple stages in your Dockerfile to do certain tasks.</p>
</div>
<div class="paragraph">
<p>In our case, we have two stages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first one uses <code>maven:3.3-jdk-8</code> as its base image to download and build the project and its dependencies using Maven.</p>
</li>
<li>
<p>The second stage uses <code>openliberty/open-liberty:springBoot2-ubi-min</code> as its base image to run the compiled code from the previous stage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The advantage of using the multi-stage builds approach is that the resulting image only uses the base image of the last stage. Meaning that in our case, we will only end up with the <code>openliberty/open-liberty:springBoot2-ubi-min</code> as our base image, which is much tinier than having an image that has both Maven and the JRE.</p>
</div>
<div class="paragraph">
<p>By using the multi-stage builds approach when it makes sense to use it, you will end up with much lighter and easier to maintain images, which can save you space on your Docker Registry. Also, having tinier images usually means less resource consumption on your worker nodes, which can result cost-savings.</p>
</div>
<div class="paragraph">
<p>To build the docker image, run the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker build -f Dockerfile.multistage -t greeting:v2.0.0 .</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker build -f Dockerfile.multistage -t greeting:v2.0.0 .
Sending build context to Docker daemon  22.17MB
Step 1/21 : FROM maven:3.3-jdk-8 as builder
3.3-jdk-8: Pulling from library/maven
6d827a3ef358: Pull complete
2726297beaf1: Pull complete
7d27bd3d7fec: Pull complete
e61641c845ed: Pull complete
cce4cca5b76b: Pull complete
6826227500b0: Pull complete
c03b117ffd91: Pull complete
821a1547b435: Pull complete
2bd47f6b1b42: Pull complete
e4cf3e9f705c: Pull complete
3733107c5c01: Pull complete
Digest: sha256:18e8bd367c73c93e29d62571ee235e106b18bf6718aeb235c7a07840328bba71
Status: Downloaded newer image for maven:3.3-jdk-8
 ---&gt; 9997d8483b2f
Step 2/21 : ENV BUILD_DIR=/usr/src/app/
 ---&gt; Running in 02c2c0bdb8bf
Removing intermediate container 02c2c0bdb8bf
 ---&gt; f09a7e2e03e7
Step 3/21 : RUN mkdir $BUILD_DIR
 ---&gt; Running in af3141c3e1fc
Removing intermediate container af3141c3e1fc
 ---&gt; 98aee6a73219
Step 4/21 : WORKDIR $BUILD_DIR
 ---&gt; Running in e85580f76678
Removing intermediate container e85580f76678
 ---&gt; e4bb0b1b310d
Step 5/21 : VOLUME ${HOME}/.m2:/root/.m2
 ---&gt; Running in bec55df2bd55
Removing intermediate container bec55df2bd55
 ---&gt; 71d3ddd3775b
Step 6/21 : ADD . /usr/src/app
 ---&gt; 3a7a1f086e77
Step 7/21 : RUN bash -c " mvn clean install"
 ---&gt; Running in 8c726a5c1380
[INFO] Scanning for projects...
Downloading: https://repo.maven.apache.org/maven2/org/springframework/boot/spring-boot-starter-parent/2.1.7.RELEASE/spring-boot-starter-parent-2.1.7.RELEASE.pom
Downloaded: https://repo.maven.apache.org/maven2/org/springframework/boot/spring-boot-starter-parent/2.1.7.RELEASE/spring-boot-starter-parent-2.1.7.RELEASE.pom (10 KB at 10.4 KB/sec)
.................
.................
.................
Step 20/21 : RUN chown -R 1001.0 /opt/ol/wlp/usr/shared/resources/lib.index.cache &amp;&amp; chmod -R g+rw /opt/ol/wlp/usr/shared/resources/lib.index.cache
 ---&gt; Running in ae77279b238c
Removing intermediate container ae77279b238c
 ---&gt; 74640a653475
Step 21/21 : USER 1001
 ---&gt; Running in 01c24024899a
Removing intermediate container 01c24024899a
 ---&gt; 55240d6d8edc
Successfully built 55240d6d8edc
Successfully tagged greeting:v2.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify if the image is built successfully, run the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker images</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will have something as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker images
REPOSITORY                           TAG                   IMAGE ID            CREATED              SIZE
greeting                             v2.0.0                55240d6d8edc        45 seconds ago       402MB
openliberty/open-liberty             springBoot2-ubi-min   bcfcb2c5ce16        6 days ago           366MB
maven                                3.3-jdk-8             9997d8483b2f        2 years ago          653MB</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_docker_container_2"><a class="anchor" href="#_run_the_docker_container_2"></a>Run the docker container</h3>
<div class="ulist">
<ul>
<li>
<p>To run the docker container, use the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -p 9080:9080 -d --name greeting_multistage greeting:v2.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once done, you will have something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -p 9080:9080 -d --name greeting_multistage greeting:v2.0.0
baf6f41b3ab785dfdccd9d83486b351a9d9718fcc3690f68e9f574e36c914844</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To list all the running containers, use the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker ps</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will have something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                              NAMES
baf6f41b3ab7        greeting:v2.0.0     "/opt/ol/helpers/run…"   26 seconds ago      Up 25 seconds       0.0.0.0:9080-&gt;9080/tcp, 9443/tcp   greeting_multistage</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To know more about the container, you can inspect the container.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Run the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker inspect &lt;container-name|container-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we consider our container, it is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker inspect greeting_multistage</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To get the logs, you use the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker logs &lt;container-name|container-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we consider our container, it is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker logs greeting_multistage</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_access_the_application_2"><a class="anchor" href="#_access_the_application_2"></a>Access the application</h3>
<div class="ulist">
<ul>
<li>
<p>To access the application, open the browser and access <a href="http://localhost:9080/greeting?name=John" class="bare">http://localhost:9080/greeting?name=John</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{"id":2,"content":"Welcome to Cloudnative bootcamp !!! Hello, John :)"}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clean_up_2"><a class="anchor" href="#_clean_up_2"></a>Clean Up</h3>
<div class="ulist">
<ul>
<li>
<p>To stop the container, run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker stop &lt;container-name|container-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For our sample application, it is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker stop greeting_multistage
greeting_multistage</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To remove the container, run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker rm &lt;container-name|container-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For our sample application, it is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker rm greeting_multistage
greeting_multistage</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To remove the image, run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker rmi &lt;image_id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Get the image_ids and then remove them. Use the below commands to do that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
greeting            v2.0.0              f79f112b85de        5 minutes ago       317MB
ibmjava             8-sfj               ab418b419902        9 days ago          222MB
maven               3.3-jdk-8           9997d8483b2f        2 years ago         653MB

$ docker rmi f79f112b85de ab418b419902 9997d8483b2f
Untagged: greeting:v2.0.0
Deleted: sha256:f79f112b85de5ecfd0bda14e513c46fe6ca97d7a482b558125a2ae6e746f4fa8
Deleted: sha256:78b047c21b2efe3b407dfa94274dfab63711a21ab17361e4ef2045bac2cdb510
Deleted: sha256:62d507c2ca92e54550759715e481588568461393d300e1e17a1cccb0ef42c65a
Deleted: sha256:adc85f6f75dc02ec2df1f693392656d07ab6d6e1d8afe5c25faf4ab4c514dee7
Deleted: sha256:ac671642300875b39c4fdc7ce4de82a7d1367f946644b13573f1ae31c490a12e
Deleted: sha256:39221665a68e2890f4c3dba1cc977e16340f8e328be2697b1b89a6a2b8e9c246
Deleted: sha256:c2c568f2599e5b74f79cbe2ebfbdf1c970ee6c3848e52494094b0e2d5632a40f
Deleted: sha256:320f2d955769604fefff9ab673f2e4c4815e050f8eff51f83351df3691f373f5
Deleted: sha256:64bc278ff6faceaf74159a463525d4dfe523392308a5a6d735e4e626a16885a7
Deleted: sha256:1482dbbeb1629cd9b729092d25d0b666a739c53fe1531f74635179f77ba1ac93
Deleted: sha256:c3cdbce0b6e8a74ea8cb81dc2a91cb399d64eb75558c3a2ace825a7b3999e042
Untagged: ibmjava:8-sfj
Untagged: ibmjava@sha256:aaef6e7d14b3c63b8df9eaea45334d3cc7678ba3878dfcb630be8706719df97e
Deleted: sha256:ab418b419902ecc54a6f2b4c0f485c1105eec3395f253040087a954528de7b1b
Deleted: sha256:2ffcfbe8352bdf9c70b66692e436ab03f01ca3dce37d7d49c79f5c4c80ec2044
Deleted: sha256:c896bc720df99ee1a6ce305d17edfda42b043a47223ff2ac3e4f94199e6d595b
Deleted: sha256:03952d61b1fc131f23629c02f7ffb93708ae77108a32e4eedd83d4ec987ba51c
Deleted: sha256:a48e1b8909b41276ed1666d5262d981258163c6f0998b58e61efa4188944652e
Deleted: sha256:872ef8aee8632246e43a346a70274030c3613fe81af162a2fb6d14e1fcba980d
Deleted: sha256:1ea5a27b0484f2a227275fbb913d281461d9f356134a56002574904c3cfdea04
Untagged: maven:3.3-jdk-8
Untagged: maven@sha256:18e8bd367c73c93e29d62571ee235e106b18bf6718aeb235c7a07840328bba71
Deleted: sha256:9997d8483b2fc521a4159feab922546dda0c5c22b5084f86dfab48f123ae4364
Deleted: sha256:4670a3a3ccbe1fa08dbcd29629e833086949809a5bf6fe1ac4e336b65f0c814c
Deleted: sha256:4501fab525c27427b85718fc477889071ec8a7adf2c3629bcff4246e4d1df787
Deleted: sha256:32babe003c3a531aebcdb501deb957c9933f7c90beabfab5d8805f62a084f398
Deleted: sha256:7d628fad6450f42db382a12b2d5470166b63fce76f6b1865f39718ad99accfab
Deleted: sha256:6bc44dc0c6c47463f610e82d75246a0f804c27f86bdf46a8ae1563bb3cc77142
Deleted: sha256:73d13c48b7fe3dbbf513351da9e439a2f38332c4cfcc149c6e7368dafc31e2d9
Deleted: sha256:dcd168f76c182f075b2dcdafe6a80dcb6fa4180588214df23322b706dc2b9536
Deleted: sha256:33690a5a483b7684bc809f4c4d8992d946f063b23fc99f68e661383953d910a8
Deleted: sha256:2ecb867048da2f6e2740814c177ca71c959ab2c91acaefbe827149302b20076f
Deleted: sha256:763ac6a64f068afd061160ff77b7ab41f61aba49b554bfe39ca033fcbf4f2d3c
Deleted: sha256:5d6cbe0dbcf9a675e86aa0fbedf7ed8756d557c7468d6a7c64bde7fa9e029636</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You have successfully completed this lab! Let&#8217;s take a look at what you learned and did today:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Learned about Dockerfile.</p>
</li>
<li>
<p>Learned about docker images.</p>
</li>
<li>
<p>Learned about docker containers.</p>
</li>
<li>
<p>Learned about multi-stage docker builds.</p>
</li>
<li>
<p>Ran the Greetings service on Docker.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Congratulations !!!</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
